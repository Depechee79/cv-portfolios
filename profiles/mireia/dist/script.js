/* core.js - CV Portfolio Core Script */
/* This file is generated - translations come from config.json */

// TRANSLATIONS - Injected by generate.js
const translations = {
  "es": {
    "nav.home": "Inicio",
    "nav.profile": "Perfil",
    "nav.experience": "Experiencia",
    "nav.education": "Formacion",
    "nav.skills": "Habilidades",
    "nav.references": "Referencias",
    "nav.contact": "Contacto",
    "hero.name": "Mireia Puchaes Cremades",
    "hero.subtitle": "RESTAURANT MANAGER",
    "hero.current": "Restaurant Manager | Meliá Hotels International",
    "hero.cta": "CONTACTAR",
    "about.title": "Perfil Profesional",
    "about.desc": "Profesional de restauracion con mas de 6 anos de experiencia gestionando restaurantes en hoteles de 5 estrellas de lujo. Trayectoria internacional en cadenas de referencia como Melia Hotels International y Radisson, donde ha desarrollado una vision integral del negocio hotelero — desde la operativa diaria de sala y cocina hasta la coordinacion con recepcion, eventos y direccion. Especializada en estandares de marca, liderazgo de equipos y experiencia del huesped.",
    "about.stat1": "+6 anos en F&B",
    "about.stat2": "Internacional (BCN & Jakarta)",
    "about.stat3": "Liderazgo de equipos",
    "exp.title": "Experiencia Profesional",
    "exp.1.date": "MAR 2025 - ACTUALIDAD",
    "exp.1.place": "Melia Hotels International — Hotel Gran Melia Jakarta",
    "exp.1.role": "Assistant Restaurant Manager",
    "exp.1.desc": "Gestion de operaciones diarias del restaurante. Supervision de equipos de servicio y coordinacion con cocina. Cumplimiento de estandares de marca Gran Melia.",
    "exp.2.date": "FEB 2024 - ACTUALIDAD",
    "exp.2.place": "Melia Hotels International — Hotel Gran Melia Torre Melina",
    "exp.2.role": "Assistant Restaurant Manager",
    "exp.2.desc": "Gestion operativa de restaurante en hotel 5 estrellas Gran Lujo. Formacion y liderazgo de equipo de sala. Control de calidad y satisfaccion del huesped.",
    "exp.3.date": "FEB 2022 - FEB 2024",
    "exp.3.place": "Radisson Blu 1882 Barcelona",
    "exp.3.role": "Food & Beverage Supervisor",
    "exp.3.desc": "Supervision de operaciones de F&B. Coordinacion de servicios de restaurante, bar y eventos. Gestion de inventarios y proveedores.",
    "exp.4.date": "DIC 2019 - ACTUALIDAD",
    "exp.4.place": "Hotel Barcelona 1882",
    "exp.4.role": "Camarera",
    "exp.4.desc": "Servicio de sala en restaurante de hotel. Atencion directa al cliente internacional.",
    "exp.5.date": "OCT 2018 - FEB 2020",
    "exp.5.place": "Arts Catering, Barcelona",
    "exp.5.role": "Camarera de Banquetes y Eventos",
    "exp.5.desc": "Servicio de catering en banquetes y eventos corporativos de alto nivel.",
    "exp.6.date": "OCT 2018 - MAY 2019",
    "exp.6.place": "Sibaris Catering, Barcelona",
    "exp.6.role": "Camarera de Banquetes y Eventos",
    "exp.6.desc": "Servicio de catering en banquetes y eventos de empresa.",
    "edu.title": "Formacion Academica",
    "edu.1.date": "SEP 2020 - MAR 2022",
    "edu.1.school": "OSTELEA, Tourism Management School",
    "edu.1.title": "Master en Gestion de Eventos, Protocolo y Turismo de Negocio",
    "edu.1.details": "Barcelona. Especializacion en organizacion de eventos, protocolo empresarial y turismo MICE.",
    "edu.2.date": "SEP 2018 - JUL 2020",
    "edu.2.school": "Escola d'Hoteleria i Turisme de Barcelona",
    "edu.2.title": "Grado Superior en Direccion de Servicios de Restauracion",
    "edu.2.details": "Formacion tecnica avanzada en gestion de restauracion y servicios de sala.",
    "edu.3.date": "SEP 2016 - JUL 2018",
    "edu.3.school": "Institut Escola del Treball, Barcelona",
    "edu.3.title": "Bachillerato",
    "edu.3.details": "Educacion secundaria postobligatoria.",
    "edu.4.date": "SEP 2012 - JUL 2016",
    "edu.4.school": "Institut Duc de Montblanc, Barcelona",
    "edu.4.title": "Educacion Secundaria Obligatoria (ESO)",
    "edu.5.date": "JUN - AGO 2018",
    "edu.5.school": "La Boqueria, Barcelona",
    "edu.5.title": "Curso de Cocina",
    "edu.5.details": "Formacion practica en tecnicas culinarias.",
    "skills.title": "Habilidades e Idiomas",
    "skills.skills_title": "Competencias",
    "skills.lang_title": "Idiomas",
    "skills.s1": "Gestion operativa de restaurante",
    "skills.s2": "Liderazgo y formacion de equipos",
    "skills.s3": "Control de costes y presupuestos",
    "skills.s4": "Estandares de marca y calidad",
    "skills.s5": "Experiencia del huesped",
    "skills.s6": "Gestion de inventarios y proveedores",
    "skills.s7": "Planificacion de eventos y banquetes",
    "skills.s8": "Coordinacion sala-cocina",
    "skills.l1.name": "Catalan",
    "skills.l1.level": "Nativo",
    "skills.l2.name": "Espanol",
    "skills.l2.level": "Nativo",
    "skills.l3.name": "Ingles",
    "skills.l3.level": "Bilingue",
    "ref.title": "Referencias",
    "ref.1.name": "Aitor Xavier Zurutuza del Rio",
    "ref.1.role": "Restaurant Manager — Erre Urrechu",
    "ref.1.company": "Hotel Gran Melia Torre Melina, Barcelona",
    "ref.2.name": "Fabian",
    "ref.2.role": "F&B Manager",
    "ref.2.company": "Hotel Gran Melia Torre Melina, Barcelona",
    "ref.3.name": "Inigo Perez Urrechu",
    "ref.3.role": "Chef & Propietario — Grupo Urrechu",
    "ref.3.company": "Fundador de Restaurantes Urrechu y Zalacain",
    "ref.note": "Datos de contacto disponibles bajo peticion.",
    "contact.title": "Contacto",
    "contact.phone": "+34 615 410 012",
    "contact.email": "mireiapuchaes@gmail.com",
    "contact.loc": "Rubi, Barcelona, Espana",
    "footer.rights": "© 2026 Mireia Puchaes Cremades. Todos los derechos reservados.",
    "btn.expand": "Ver todo",
    "btn.collapse": "Cerrar"
  },
  "en": {
    "nav.home": "Home",
    "nav.profile": "Profile",
    "nav.experience": "Experience",
    "nav.education": "Education",
    "nav.skills": "Skills",
    "nav.references": "References",
    "nav.contact": "Contact",
    "hero.name": "Mireia Puchaes Cremades",
    "hero.subtitle": "RESTAURANT MANAGER",
    "hero.current": "Restaurant Manager | Meliá Hotels International",
    "hero.cta": "CONTACT",
    "about.title": "Professional Profile",
    "about.desc": "Restaurant professional with over 6 years of experience managing restaurants within 5-star luxury hotels. International career across leading hotel chains such as Melia Hotels International and Radisson, developing a comprehensive understanding of the hospitality business — from daily front-of-house and kitchen operations to coordination with reception, events, and hotel management. Specialized in brand standards, team leadership, and guest experience.",
    "about.stat1": "6+ years in F&B",
    "about.stat2": "International (BCN & Jakarta)",
    "about.stat3": "Team Leadership",
    "exp.title": "Professional Experience",
    "exp.1.date": "MAR 2025 - PRESENT",
    "exp.1.place": "Melia Hotels International — Hotel Gran Melia Jakarta",
    "exp.1.role": "Assistant Restaurant Manager",
    "exp.1.desc": "Daily restaurant operations management. Service team supervision and kitchen coordination. Gran Melia brand standards compliance.",
    "exp.2.date": "FEB 2024 - PRESENT",
    "exp.2.place": "Melia Hotels International — Hotel Gran Melia Torre Melina",
    "exp.2.role": "Assistant Restaurant Manager",
    "exp.2.desc": "Operational management of restaurant in 5-star Grand Luxury hotel. Team training and floor leadership. Quality control and guest satisfaction.",
    "exp.3.date": "FEB 2022 - FEB 2024",
    "exp.3.place": "Radisson Blu 1882 Barcelona",
    "exp.3.role": "Food & Beverage Supervisor",
    "exp.3.desc": "F&B operations supervision. Coordination of restaurant, bar, and event services. Inventory and supplier management.",
    "exp.4.date": "DEC 2019 - PRESENT",
    "exp.4.place": "Hotel Barcelona 1882",
    "exp.4.role": "Waitress",
    "exp.4.desc": "Hotel restaurant floor service. Direct attention to international guests.",
    "exp.5.date": "OCT 2018 - FEB 2020",
    "exp.5.place": "Arts Catering, Barcelona",
    "exp.5.role": "Banquet / Event Waitress",
    "exp.5.desc": "Catering service for high-level banquets and corporate events.",
    "exp.6.date": "OCT 2018 - MAY 2019",
    "exp.6.place": "Sibaris Catering, Barcelona",
    "exp.6.role": "Banquet / Event Waitress",
    "exp.6.desc": "Catering service for banquets and corporate events.",
    "edu.title": "Education",
    "edu.1.date": "SEP 2020 - MAR 2022",
    "edu.1.school": "OSTELEA, Tourism Management School",
    "edu.1.title": "Master's in Event Management, Protocol & Business Tourism",
    "edu.1.details": "Barcelona. Specialization in event organization, business protocol, and MICE tourism.",
    "edu.2.date": "SEP 2018 - JUL 2020",
    "edu.2.school": "Barcelona School of Hospitality & Tourism",
    "edu.2.title": "Higher Degree in Restaurant Service Management",
    "edu.2.details": "Advanced technical training in restaurant management and floor services.",
    "edu.3.date": "SEP 2016 - JUL 2018",
    "edu.3.school": "Institut Escola del Treball, Barcelona",
    "edu.3.title": "General Certificate of Education",
    "edu.3.details": "Post-compulsory secondary education.",
    "edu.4.date": "SEP 2012 - JUL 2016",
    "edu.4.school": "Institut Duc de Montblanc, Barcelona",
    "edu.4.title": "General Certificate of Secondary Education (GCSE)",
    "edu.5.date": "JUN - AUG 2018",
    "edu.5.school": "La Boqueria, Barcelona",
    "edu.5.title": "Cooking Class",
    "edu.5.details": "Hands-on training in culinary techniques.",
    "skills.title": "Skills & Languages",
    "skills.skills_title": "Competencies",
    "skills.lang_title": "Languages",
    "skills.s1": "Restaurant Operations Management",
    "skills.s2": "Team Leadership & Training",
    "skills.s3": "Cost Control & Budgeting",
    "skills.s4": "Brand Standards & Quality",
    "skills.s5": "Guest Experience",
    "skills.s6": "Inventory & Supplier Management",
    "skills.s7": "Event & Banquet Planning",
    "skills.s8": "Front-of-House & Kitchen Coordination",
    "skills.l1.name": "Catalan",
    "skills.l1.level": "Native",
    "skills.l2.name": "Spanish",
    "skills.l2.level": "Native",
    "skills.l3.name": "English",
    "skills.l3.level": "Bilingual",
    "ref.title": "References",
    "ref.1.name": "Aitor Xavier Zurutuza del Rio",
    "ref.1.role": "Restaurant Manager — Erre Urrechu",
    "ref.1.company": "Hotel Gran Melia Torre Melina, Barcelona",
    "ref.2.name": "Fabian",
    "ref.2.role": "F&B Manager",
    "ref.2.company": "Hotel Gran Melia Torre Melina, Barcelona",
    "ref.3.name": "Inigo Perez Urrechu",
    "ref.3.role": "Chef & Owner — Grupo Urrechu",
    "ref.3.company": "Founder of Restaurantes Urrechu and Zalacain",
    "ref.note": "Contact details available upon request.",
    "contact.title": "Contact",
    "contact.phone": "+34 615 410 012",
    "contact.email": "mireiapuchaes@gmail.com",
    "contact.loc": "Rubi, Barcelona, Spain",
    "footer.rights": "© 2026 Mireia Puchaes Cremades. All rights reserved.",
    "btn.expand": "See all",
    "btn.collapse": "Close"
  },
  "ca": {
    "nav.home": "Inici",
    "nav.profile": "Perfil",
    "nav.experience": "Experiencia",
    "nav.education": "Formacio",
    "nav.skills": "Habilitats",
    "nav.references": "References",
    "nav.contact": "Contacte",
    "hero.name": "Mireia Puchaes Cremades",
    "hero.subtitle": "RESTAURANT MANAGER",
    "hero.current": "Restaurant Manager | Meliá Hotels International",
    "hero.cta": "CONTACTAR",
    "about.title": "Perfil Professional",
    "about.desc": "Professional de restauracio amb mes de 6 anys d'experiencia gestionant restaurants en hotels de 5 estrelles de luxe. Trajectoria internacional en cadenes de referencia com Melia Hotels International i Radisson, on ha desenvolupat una visio integral del negoci hoteler — des de l'operativa diaria de sala i cuina fins a la coordinacio amb recepcio, esdeveniments i direccio. Especialitzada en estandards de marca, lideratge d'equips i experiencia de l'hoste.",
    "about.stat1": "+6 anys en F&B",
    "about.stat2": "Internacional (BCN & Jakarta)",
    "about.stat3": "Lideratge d'equips",
    "exp.title": "Experiencia Professional",
    "exp.1.date": "MAR 2025 - ACTUALITAT",
    "exp.1.place": "Melia Hotels International — Hotel Gran Melia Jakarta",
    "exp.1.role": "Assistant Restaurant Manager",
    "exp.1.desc": "Gestio d'operacions diaries del restaurant. Supervisio d'equips de servei i coordinacio amb cuina. Compliment d'estandards de marca Gran Melia.",
    "exp.2.date": "FEB 2024 - ACTUALITAT",
    "exp.2.place": "Melia Hotels International — Hotel Gran Melia Torre Melina",
    "exp.2.role": "Assistant Restaurant Manager",
    "exp.2.desc": "Gestio operativa de restaurant en hotel 5 estrelles Gran Luxe. Formacio i lideratge d'equip de sala. Control de qualitat i satisfaccio de l'hoste.",
    "exp.3.date": "FEB 2022 - FEB 2024",
    "exp.3.place": "Radisson Blu 1882 Barcelona",
    "exp.3.role": "Food & Beverage Supervisor",
    "exp.3.desc": "Supervisio d'operacions de F&B. Coordinacio de serveis de restaurant, bar i esdeveniments. Gestio d'inventaris i proveidors.",
    "exp.4.date": "DES 2019 - ACTUALITAT",
    "exp.4.place": "Hotel Barcelona 1882",
    "exp.4.role": "Cambrera",
    "exp.4.desc": "Servei de sala en restaurant d'hotel. Atencio directa al client internacional.",
    "exp.5.date": "OCT 2018 - FEB 2020",
    "exp.5.place": "Arts Catering, Barcelona",
    "exp.5.role": "Cambrera de Banquets i Esdeveniments",
    "exp.5.desc": "Servei de catering en banquets i esdeveniments corporatius d'alt nivell.",
    "exp.6.date": "OCT 2018 - MAI 2019",
    "exp.6.place": "Sibaris Catering, Barcelona",
    "exp.6.role": "Cambrera de Banquets i Esdeveniments",
    "exp.6.desc": "Servei de catering en banquets i esdeveniments d'empresa.",
    "edu.title": "Formacio Academica",
    "edu.1.date": "SET 2020 - MAR 2022",
    "edu.1.school": "OSTELEA, Tourism Management School",
    "edu.1.title": "Master en Gestio d'Esdeveniments, Protocol i Turisme de Negoci",
    "edu.1.details": "Barcelona. Especialitzacio en organitzacio d'esdeveniments, protocol empresarial i turisme MICE.",
    "edu.2.date": "SET 2018 - JUL 2020",
    "edu.2.school": "Escola d'Hoteleria i Turisme de Barcelona",
    "edu.2.title": "Grau Superior en Direccio de Serveis de Restauracio",
    "edu.2.details": "Formacio tecnica avancada en gestio de restauracio i serveis de sala.",
    "edu.3.date": "SET 2016 - JUL 2018",
    "edu.3.school": "Institut Escola del Treball, Barcelona",
    "edu.3.title": "Batxillerat",
    "edu.3.details": "Educacio secundaria postobligatoria.",
    "edu.4.date": "SET 2012 - JUL 2016",
    "edu.4.school": "Institut Duc de Montblanc, Barcelona",
    "edu.4.title": "Educacio Secundaria Obligatoria (ESO)",
    "edu.5.date": "JUN - AGO 2018",
    "edu.5.school": "La Boqueria, Barcelona",
    "edu.5.title": "Curs de Cuina",
    "edu.5.details": "Formacio practica en tecniques culinaries.",
    "skills.title": "Habilitats i Idiomes",
    "skills.skills_title": "Competencies",
    "skills.lang_title": "Idiomes",
    "skills.s1": "Gestio operativa de restaurant",
    "skills.s2": "Lideratge i formacio d'equips",
    "skills.s3": "Control de costos i pressupostos",
    "skills.s4": "Estandards de marca i qualitat",
    "skills.s5": "Experiencia de l'hoste",
    "skills.s6": "Gestio d'inventaris i proveidors",
    "skills.s7": "Planificacio d'esdeveniments",
    "skills.s8": "Coordinacio sala-cuina",
    "skills.l1.name": "Catala",
    "skills.l1.level": "Natiu",
    "skills.l2.name": "Espanyol",
    "skills.l2.level": "Natiu",
    "skills.l3.name": "Angles",
    "skills.l3.level": "Bilingue",
    "ref.title": "References",
    "ref.1.name": "Aitor Xavier Zurutuza del Rio",
    "ref.1.role": "Restaurant Manager — Erre Urrechu",
    "ref.1.company": "Hotel Gran Melia Torre Melina, Barcelona",
    "ref.2.name": "Fabian",
    "ref.2.role": "F&B Manager",
    "ref.2.company": "Hotel Gran Melia Torre Melina, Barcelona",
    "ref.3.name": "Inigo Perez Urrechu",
    "ref.3.role": "Xef & Propietari — Grup Urrechu",
    "ref.3.company": "Fundador de Restaurants Urrechu i Zalacain",
    "ref.note": "Dades de contacte disponibles sota peticio.",
    "contact.title": "Contacte",
    "contact.phone": "+34 615 410 012",
    "contact.email": "mireiapuchaes@gmail.com",
    "contact.loc": "Rubi, Barcelona, Espanya",
    "footer.rights": "© 2026 Mireia Puchaes Cremades. Tots els drets reservats.",
    "btn.expand": "Veure tot",
    "btn.collapse": "Tancar"
  }
};

// DARK SECTIONS - Injected by generate.js
const darkSections = ["about","experience","skills"];

// EXPANDABLE TIMELINE LOGIC
window.toggleTimeline = function (id, btn) {
    const container = document.getElementById(id);
    const isCollapsed = container.classList.contains('collapsed');
    const currentLang = localStorage.getItem('preferredLang') || 'es';

    if (isCollapsed) {
        // EXPAND
        container.classList.remove('collapsed');
        container.classList.add('expanded');

        const span = btn.querySelector('span');
        const icon = btn.querySelector('ion-icon');
        if (span) span.textContent = translations[currentLang]["btn.collapse"] || "Cerrar";
        if (icon) icon.setAttribute('name', 'chevron-up-outline');

        container.scrollTop = 0;

        // Add scroll listener for auto-collapse at end (with debounce)
        let scrollTimeout = null;
        container._scrollEndHandler = function() {
            // Debounce: wait 300ms after scroll stops
            if (scrollTimeout) clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const scrollBottom = container.scrollTop + container.clientHeight;
                const scrollMax = container.scrollHeight;

                // If scrolled to within 5px of absolute bottom, collapse and scroll to next section
                if (scrollBottom >= scrollMax - 5) {
                    collapseAndScrollNext(container, btn);
                }
            }, 300);
        };
        container.addEventListener('scroll', container._scrollEndHandler);
    } else {
        // COLLAPSE
        collapseTimeline(container, btn);
    }
};

function collapseTimeline(container, btn) {
    const currentLang = localStorage.getItem('preferredLang') || 'es';

    container.classList.add('collapsed');
    container.classList.remove('expanded');

    // Remove scroll listener
    if (container._scrollEndHandler) {
        container.removeEventListener('scroll', container._scrollEndHandler);
        container._scrollEndHandler = null;
    }

    const span = btn.querySelector('span');
    const icon = btn.querySelector('ion-icon');
    if (span) span.textContent = translations[currentLang]["btn.expand"] || "Ver todo";
    if (icon) icon.setAttribute('name', 'chevron-down-outline');

    container.scrollTop = 0;
}

function collapseAndScrollNext(container, btn) {
    // First, collapse the timeline
    collapseTimeline(container, btn);

    // Find the parent section
    const section = container.closest('section');
    if (!section) return;

    // Find the next sibling section
    const nextSection = section.nextElementSibling;
    if (nextSection && (nextSection.tagName === 'SECTION' || nextSection.tagName === 'FOOTER')) {
        // Small delay to let collapse animation start
        setTimeout(() => {
            nextSection.scrollIntoView({ behavior: 'auto', block: 'start' });
        }, 100);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    // Language Switcher
    let currentLang = localStorage.getItem('preferredLang') || 'es';
    updateLanguage(currentLang);

    // Lang Switcher Interaction
    const langSwitcher = document.querySelector('.lang-switcher-bottom');
    if (langSwitcher) {
        langSwitcher.addEventListener('click', function (e) {
            const targetBtn = e.target.closest('.lang-btn-bottom');
            if (!targetBtn) return;

            if (this.classList.contains('expanded')) {
                if (!targetBtn.classList.contains('active')) {
                    const selectedLang = targetBtn.getAttribute('data-lang');
                    if (selectedLang) {
                        currentLang = selectedLang;
                        updateLanguage(currentLang);
                    }
                }
                this.classList.remove('expanded');
            } else {
                this.classList.add('expanded');
            }
        });

        document.addEventListener('click', function (e) {
            if (!langSwitcher.contains(e.target)) {
                langSwitcher.classList.remove('expanded');
            }
        });
    }

    // BURGER MENU LOGIC
    window.toggleBurgerMenu = function () {
        const burgerBtn = document.getElementById('burger-btn');
        const menuOverlay = document.getElementById('menu-overlay');
        const cutleryBurger = burgerBtn ? burgerBtn.querySelector('.cutlery-burger') : null;
        const bottomNav = document.querySelector('.bottom-nav');
        if (!burgerBtn || !menuOverlay) return;

        menuOverlay.classList.toggle('open');
        if (cutleryBurger) {
            cutleryBurger.classList.toggle('burger-open');
        }
        // Toggle gold colors when menu overlay is open (dark background)
        if (bottomNav) {
            bottomNav.classList.toggle('menu-open', menuOverlay.classList.contains('open'));
        }
    };

    // Close menu on link click — scroll within #app-scroller
    document.querySelectorAll('.menu-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const menuOverlay = document.getElementById('menu-overlay');
            const burgerBtn = document.getElementById('burger-btn');
            const bottomNav = document.querySelector('.bottom-nav');
            if (menuOverlay) menuOverlay.classList.remove('open');
            if (burgerBtn) {
                const cutleryBurger = burgerBtn.querySelector('.cutlery-burger');
                if (cutleryBurger) cutleryBurger.classList.remove('burger-open');
            }
            if (bottomNav) bottomNav.classList.remove('menu-open');

            // Scroll to section within #app-scroller
            const targetId = link.getAttribute('href').replace('#', '');
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        });
    });

    // Handle CTA button scroll within #app-scroller
    const ctaBtn = document.querySelector('.btn-primary[href="#contact"]');
    if (ctaBtn) {
        ctaBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const contactSection = document.getElementById('contact');
            if (contactSection) {
                contactSection.scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        });
    }

    // Set initial nav color
    if (document.querySelector('.bottom-nav')) {
        document.querySelector('.bottom-nav').style.setProperty('--nav-adaptive-color', 'rgb(28,28,28)');
    }
});

// Adaptive nav colors — scroll-synced loop
function _navColorTick() {
    var nav = document.querySelector('.bottom-nav');
    var scroller = document.getElementById('app-scroller');
    if (!nav || !scroller) return;
    if (nav.classList.contains('menu-open')) return;

    var rect = scroller.getBoundingClientRect();
    var viewH = rect.height;
    if (viewH <= 0) return;

    var sections = document.querySelectorAll('header, section, footer');
    var dark = 0;

    for (var i = 0; i < sections.length; i++) {
        var s = sections[i];
        var sr = s.getBoundingClientRect();
        var vt = Math.max(sr.top, rect.top);
        var vb = Math.min(sr.bottom, rect.bottom);
        var vh = vb - vt;
        if (vh > 0 && darkSections.indexOf(s.id) !== -1) {
            dark += vh / viewH;
        }
    }

    dark = Math.min(1, Math.max(0, dark));
    var r = Math.round(28 + 156 * dark);
    var g = Math.round(28 + 121 * dark);
    var b = Math.round(28 + 78 * dark);
    nav.style.setProperty('--nav-adaptive-color', 'rgb(' + r + ',' + g + ',' + b + ')');
}
setInterval(_navColorTick, 16);

// Snap-visible detection
var _lastVisibleSection = null;
function _snapVisibleTick() {
    var scroller = document.getElementById('app-scroller');
    if (!scroller) return;

    var scrollerRect = scroller.getBoundingClientRect();
    var centerY = scrollerRect.top + scrollerRect.height / 2;

    var sections = document.querySelectorAll('header, section, footer');
    var bestSection = null;
    var bestOverlap = 0;

    for (var i = 0; i < sections.length; i++) {
        var s = sections[i];
        var sr = s.getBoundingClientRect();
        var vt = Math.max(sr.top, scrollerRect.top);
        var vb = Math.min(sr.bottom, scrollerRect.bottom);
        var vh = vb - vt;

        if (vh > bestOverlap) {
            bestOverlap = vh;
            bestSection = s;
        }
    }

    if (bestSection && bestSection !== _lastVisibleSection) {
        if (_lastVisibleSection) {
            _lastVisibleSection.classList.remove('snap-visible');
        }
        bestSection.classList.add('snap-visible');
        _lastVisibleSection = bestSection;

        // Auto-collapse timelines when leaving experience/education sections
        if (bestSection &&
            (bestSection.id === 'experience' || bestSection.id === 'education')) {
            // Do nothing, user is viewing this section
        } else {
            var expandedTimelines = document.querySelectorAll('.timeline-container.expanded');
            expandedTimelines.forEach(function(tl) {
                var btn = tl.parentElement.querySelector('.btn-expand');
                if (btn) {
                    collapseTimeline(tl, btn);
                }
            });
        }
    }
}
setInterval(_snapVisibleTick, 100);

function updateLanguage(lang) {
    if (!translations[lang]) return;

    // Update text content
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
            el.textContent = translations[lang][key];
        }
    });

    // Update active button
    document.querySelectorAll('.lang-btn-bottom').forEach(btn => {
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });

    // Save preference
    localStorage.setItem('preferredLang', lang);
}
