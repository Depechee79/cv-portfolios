/* core.js - CV Portfolio Core Script */
/* This file is generated - translations come from config.json */

// TRANSLATIONS - Injected by generate.js
const translations = {
  "es": {
    "nav.home": "Inicio",
    "nav.profile": "Perfil",
    "nav.experience": "Experiencia",
    "nav.education": "Formación",
    "nav.skills": "Habilidades",
    "nav.references": "Referencias",
    "nav.contact": "Contacto",
    "hero.name": "Mireia Puchaes Cremades",
    "hero.subtitle": "RESTAURANT MANAGER",
    "hero.current": "Restaurant Manager | Meliá Hotels International",
    "hero.cta": "CONTACTAR",
    "about.title": "Perfil Profesional",
    "about.desc": "Profesional de restauración con más de 6 años de experiencia gestionando restaurantes en hoteles de 5 estrellas de lujo. Trayectoria internacional en cadenas de referencia como Meliá Hotels International y Radisson, donde ha desarrollado una visión integral del negocio hotelero — desde la operativa diaria de sala y cocina hasta la coordinación con recepción, eventos y dirección. Especializada en estándares de marca, liderazgo de equipos y experiencia del huésped.",
    "about.stat1": "+6 años en F&B",
    "about.stat2": "Internacional (BCN & Jakarta)",
    "about.stat3": "Liderazgo de equipos",
    "exp.title": "Experiencia Profesional",
    "exp.1.date": "MAR 2025 - ACTUALIDAD",
    "exp.1.place": "Meliá Hotels International — Hotel Gran Meliá Jakarta",
    "exp.1.role": "Assistant Restaurant Manager",
    "exp.1.desc": "Gestión de operaciones diarias del restaurante. Supervisión de equipos de servicio y coordinación con cocina. Cumplimiento de estándares de marca Gran Meliá.",
    "exp.2.date": "FEB 2024 - MAR 2025",
    "exp.2.place": "Meliá Hotels International — Hotel Gran Meliá Torre Melina",
    "exp.2.role": "Assistant Restaurant Manager",
    "exp.2.desc": "Gestión operativa de restaurante en hotel 5 estrellas Gran Lujo. Formación y liderazgo de equipo de sala. Control de calidad y satisfacción del huésped.",
    "exp.3.date": "FEB 2022 - FEB 2024",
    "exp.3.place": "Radisson Blu 1882 Barcelona",
    "exp.3.role": "Food & Beverage Supervisor",
    "exp.3.desc": "Supervisión de operaciones de F&B. Coordinación de servicios de restaurante, bar y eventos. Gestión de inventarios y proveedores.",
    "exp.4.date": "DIC 2019 - FEB 2022",
    "exp.4.place": "Hotel Barcelona 1882",
    "exp.4.role": "Camarera",
    "exp.4.desc": "Servicio de sala en restaurante de hotel. Atención directa al cliente internacional.",
    "exp.5.date": "OCT 2018 - FEB 2020",
    "exp.5.place": "Arts Catering, Barcelona",
    "exp.5.role": "Camarera de Banquetes y Eventos",
    "exp.5.desc": "Servicio de catering en banquetes y eventos corporativos de alto nivel.",
    "exp.6.date": "OCT 2018 - MAY 2019",
    "exp.6.place": "Sibaris Catering, Barcelona",
    "exp.6.role": "Camarera de Banquetes y Eventos",
    "exp.6.desc": "Servicio de catering en banquetes y eventos de empresa.",
    "edu.title": "Formación Académica",
    "edu.1.date": "SEP 2020 - MAR 2022",
    "edu.1.school": "OSTELEA, Tourism Management School",
    "edu.1.title": "Máster en Gestión de Eventos, Protocolo y Turismo de Negocio",
    "edu.1.details": "Barcelona. Especialización en organización de eventos, protocolo empresarial y turismo MICE.",
    "edu.2.date": "SEP 2018 - JUL 2020",
    "edu.2.school": "Escola d'Hoteleria i Turisme de Barcelona",
    "edu.2.title": "Grado Superior en Dirección de Servicios de Restauración",
    "edu.2.details": "Formación técnica avanzada en gestión de restauración y servicios de sala.",
    "edu.3.date": "JUN - AGO 2018",
    "edu.3.school": "La Boqueria, Barcelona",
    "edu.3.title": "Curso de Cocina",
    "edu.3.details": "Formación práctica en técnicas culinarias.",
    "edu.4.date": "SEP 2016 - JUL 2018",
    "edu.4.school": "Institut Escola del Treball, Barcelona",
    "edu.4.title": "Bachillerato",
    "edu.4.details": "Educación secundaria postobligatoria.",
    "edu.5.date": "SEP 2012 - JUL 2016",
    "edu.5.school": "Institut Duc de Montblanc, Barcelona",
    "edu.5.title": "Educación Secundaria Obligatoria (ESO)",
    "skills.title": "Habilidades e Idiomas",
    "skills.skills_title": "Competencias",
    "skills.lang_title": "Idiomas",
    "skills.s1": "Gestión operativa de restaurante",
    "skills.s2": "Liderazgo y formación de equipos",
    "skills.s3": "Control de costes y presupuestos",
    "skills.s4": "Estándares de marca y calidad",
    "skills.s5": "Experiencia del huésped",
    "skills.s6": "Gestión de inventarios y proveedores",
    "skills.s7": "Planificación de eventos y banquetes",
    "skills.s8": "Coordinación sala-cocina",
    "skills.l1.name": "Catalán",
    "skills.l1.level": "Nativo",
    "skills.l2.name": "Español",
    "skills.l2.level": "Nativo",
    "skills.l3.name": "Inglés",
    "skills.l3.level": "Bilingüe",
    "ref.title": "Referencias",
    "ref.1.name": "Carmine Donadio",
    "ref.1.role": "F&B Director",
    "ref.1.company": "Gran Meliá Jakarta",
    "ref.2.name": "Airam Lorenzo",
    "ref.2.role": "F&B Director",
    "ref.2.company": "Gran Meliá Torre Melina",
    "ref.3.name": "Aitor Xavier Zurutuza",
    "ref.3.role": "F&B Manager",
    "ref.3.company": "Oteiza Akelarre",
    "ref.note": "Datos de contacto disponibles bajo petición.",
    "contact.title": "Contacto",
    "contact.phone": "+34 615 410 012",
    "contact.email": "mireiapuchaes@gmail.com",
    "contact.loc": "Rubí, Barcelona, España",
    "footer.rights": "© 2026 Mireia Puchaes Cremades. Todos los derechos reservados.",
    "btn.expand": "Ver todo",
    "btn.collapse": "Cerrar",
    "btn.download": "Descargar CV"
  },
  "en": {
    "nav.home": "Home",
    "nav.profile": "Profile",
    "nav.experience": "Experience",
    "nav.education": "Education",
    "nav.skills": "Skills",
    "nav.references": "References",
    "nav.contact": "Contact",
    "hero.name": "Mireia Puchaes Cremades",
    "hero.subtitle": "RESTAURANT MANAGER",
    "hero.current": "Restaurant Manager | Meliá Hotels International",
    "hero.cta": "CONTACT",
    "about.title": "Professional Profile",
    "about.desc": "Restaurant professional with over 6 years of experience managing restaurants within 5-star luxury hotels. International career across leading hotel chains such as Meliá Hotels International and Radisson, developing a comprehensive understanding of the hospitality business — from daily front-of-house and kitchen operations to coordination with reception, events, and hotel management. Specialized in brand standards, team leadership, and guest experience.",
    "about.stat1": "6+ years in F&B",
    "about.stat2": "International (BCN & Jakarta)",
    "about.stat3": "Team Leadership",
    "exp.title": "Professional Experience",
    "exp.1.date": "MAR 2025 - PRESENT",
    "exp.1.place": "Meliá Hotels International — Hotel Gran Meliá Jakarta",
    "exp.1.role": "Assistant Restaurant Manager",
    "exp.1.desc": "Daily restaurant operations management. Service team supervision and kitchen coordination. Gran Meliá brand standards compliance.",
    "exp.2.date": "FEB 2024 - MAR 2025",
    "exp.2.place": "Meliá Hotels International — Hotel Gran Meliá Torre Melina",
    "exp.2.role": "Assistant Restaurant Manager",
    "exp.2.desc": "Operational management of restaurant in 5-star Grand Luxury hotel. Team training and floor leadership. Quality control and guest satisfaction.",
    "exp.3.date": "FEB 2022 - FEB 2024",
    "exp.3.place": "Radisson Blu 1882 Barcelona",
    "exp.3.role": "Food & Beverage Supervisor",
    "exp.3.desc": "F&B operations supervision. Coordination of restaurant, bar, and event services. Inventory and supplier management.",
    "exp.4.date": "DEC 2019 - FEB 2022",
    "exp.4.place": "Hotel Barcelona 1882",
    "exp.4.role": "Waitress",
    "exp.4.desc": "Hotel restaurant floor service. Direct attention to international guests.",
    "exp.5.date": "OCT 2018 - FEB 2020",
    "exp.5.place": "Arts Catering, Barcelona",
    "exp.5.role": "Banquet / Event Waitress",
    "exp.5.desc": "Catering service for high-level banquets and corporate events.",
    "exp.6.date": "OCT 2018 - MAY 2019",
    "exp.6.place": "Sibaris Catering, Barcelona",
    "exp.6.role": "Banquet / Event Waitress",
    "exp.6.desc": "Catering service for banquets and corporate events.",
    "edu.title": "Education",
    "edu.1.date": "SEP 2020 - MAR 2022",
    "edu.1.school": "OSTELEA, Tourism Management School",
    "edu.1.title": "Master's in Event Management, Protocol & Business Tourism",
    "edu.1.details": "Barcelona. Specialization in event organization, business protocol, and MICE tourism.",
    "edu.2.date": "SEP 2018 - JUL 2020",
    "edu.2.school": "Barcelona School of Hospitality & Tourism",
    "edu.2.title": "Higher Degree in Restaurant Service Management",
    "edu.2.details": "Advanced technical training in restaurant management and floor services.",
    "edu.3.date": "JUN - AUG 2018",
    "edu.3.school": "La Boqueria, Barcelona",
    "edu.3.title": "Cooking Class",
    "edu.3.details": "Hands-on training in culinary techniques.",
    "edu.4.date": "SEP 2016 - JUL 2018",
    "edu.4.school": "Institut Escola del Treball, Barcelona",
    "edu.4.title": "General Certificate of Education",
    "edu.4.details": "Post-compulsory secondary education.",
    "edu.5.date": "SEP 2012 - JUL 2016",
    "edu.5.school": "Institut Duc de Montblanc, Barcelona",
    "edu.5.title": "General Certificate of Secondary Education (GCSE)",
    "skills.title": "Skills & Languages",
    "skills.skills_title": "Competencies",
    "skills.lang_title": "Languages",
    "skills.s1": "Restaurant Operations Management",
    "skills.s2": "Team Leadership & Training",
    "skills.s3": "Cost Control & Budgeting",
    "skills.s4": "Brand Standards & Quality",
    "skills.s5": "Guest Experience",
    "skills.s6": "Inventory & Supplier Management",
    "skills.s7": "Event & Banquet Planning",
    "skills.s8": "Front-of-House & Kitchen Coordination",
    "skills.l1.name": "Catalan",
    "skills.l1.level": "Native",
    "skills.l2.name": "Spanish",
    "skills.l2.level": "Native",
    "skills.l3.name": "English",
    "skills.l3.level": "Bilingual",
    "ref.title": "References",
    "ref.1.name": "Carmine Donadio",
    "ref.1.role": "F&B Director",
    "ref.1.company": "Gran Meliá Jakarta",
    "ref.2.name": "Airam Lorenzo",
    "ref.2.role": "F&B Director",
    "ref.2.company": "Gran Meliá Torre Melina",
    "ref.3.name": "Aitor Xavier Zurutuza",
    "ref.3.role": "F&B Manager",
    "ref.3.company": "Oteiza Akelarre",
    "ref.note": "Contact details available upon request.",
    "contact.title": "Contact",
    "contact.phone": "+34 615 410 012",
    "contact.email": "mireiapuchaes@gmail.com",
    "contact.loc": "Rubí, Barcelona, Spain",
    "footer.rights": "© 2026 Mireia Puchaes Cremades. All rights reserved.",
    "btn.expand": "See all",
    "btn.collapse": "Close",
    "btn.download": "Download CV"
  },
  "ca": {
    "nav.home": "Inici",
    "nav.profile": "Perfil",
    "nav.experience": "Experiència",
    "nav.education": "Formació",
    "nav.skills": "Habilitats",
    "nav.references": "Referències",
    "nav.contact": "Contacte",
    "hero.name": "Mireia Puchaes Cremades",
    "hero.subtitle": "RESTAURANT MANAGER",
    "hero.current": "Restaurant Manager | Meliá Hotels International",
    "hero.cta": "CONTACTAR",
    "about.title": "Perfil Professional",
    "about.desc": "Professional de restauració amb més de 6 anys d'experiència gestionant restaurants en hotels de 5 estrelles de luxe. Trajectòria internacional en cadenes de referència com Meliá Hotels International i Radisson, on ha desenvolupat una visió integral del negoci hoteler — des de l'operativa diària de sala i cuina fins a la coordinació amb recepció, esdeveniments i direcció. Especialitzada en estàndards de marca, lideratge d'equips i experiència de l'hoste.",
    "about.stat1": "+6 anys en F&B",
    "about.stat2": "Internacional (BCN & Jakarta)",
    "about.stat3": "Lideratge d'equips",
    "exp.title": "Experiència Professional",
    "exp.1.date": "MAR 2025 - ACTUALITAT",
    "exp.1.place": "Meliá Hotels International — Hotel Gran Meliá Jakarta",
    "exp.1.role": "Assistant Restaurant Manager",
    "exp.1.desc": "Gestió d'operacions diàries del restaurant. Supervisió d'equips de servei i coordinació amb cuina. Compliment d'estàndards de marca Gran Meliá.",
    "exp.2.date": "FEB 2024 - MAR 2025",
    "exp.2.place": "Meliá Hotels International — Hotel Gran Meliá Torre Melina",
    "exp.2.role": "Assistant Restaurant Manager",
    "exp.2.desc": "Gestió operativa de restaurant en hotel 5 estrelles Gran Luxe. Formació i lideratge d'equip de sala. Control de qualitat i satisfacció de l'hoste.",
    "exp.3.date": "FEB 2022 - FEB 2024",
    "exp.3.place": "Radisson Blu 1882 Barcelona",
    "exp.3.role": "Food & Beverage Supervisor",
    "exp.3.desc": "Supervisió d'operacions de F&B. Coordinació de serveis de restaurant, bar i esdeveniments. Gestió d'inventaris i proveïdors.",
    "exp.4.date": "DES 2019 - FEB 2022",
    "exp.4.place": "Hotel Barcelona 1882",
    "exp.4.role": "Cambrera",
    "exp.4.desc": "Servei de sala en restaurant d'hotel. Atenció directa al client internacional.",
    "exp.5.date": "OCT 2018 - FEB 2020",
    "exp.5.place": "Arts Catering, Barcelona",
    "exp.5.role": "Cambrera de Banquets i Esdeveniments",
    "exp.5.desc": "Servei de càtering en banquets i esdeveniments corporatius d'alt nivell.",
    "exp.6.date": "OCT 2018 - MAI 2019",
    "exp.6.place": "Sibaris Catering, Barcelona",
    "exp.6.role": "Cambrera de Banquets i Esdeveniments",
    "exp.6.desc": "Servei de càtering en banquets i esdeveniments d'empresa.",
    "edu.title": "Formació Acadèmica",
    "edu.1.date": "SET 2020 - MAR 2022",
    "edu.1.school": "OSTELEA, Tourism Management School",
    "edu.1.title": "Màster en Gestió d'Esdeveniments, Protocol i Turisme de Negoci",
    "edu.1.details": "Barcelona. Especialització en organització d'esdeveniments, protocol empresarial i turisme MICE.",
    "edu.2.date": "SET 2018 - JUL 2020",
    "edu.2.school": "Escola d'Hoteleria i Turisme de Barcelona",
    "edu.2.title": "Grau Superior en Direcció de Serveis de Restauració",
    "edu.2.details": "Formació tècnica avançada en gestió de restauració i serveis de sala.",
    "edu.3.date": "JUN - AGO 2018",
    "edu.3.school": "La Boqueria, Barcelona",
    "edu.3.title": "Curs de Cuina",
    "edu.3.details": "Formació pràctica en tècniques culinàries.",
    "edu.4.date": "SET 2016 - JUL 2018",
    "edu.4.school": "Institut Escola del Treball, Barcelona",
    "edu.4.title": "Batxillerat",
    "edu.4.details": "Educació secundària postobligatòria.",
    "edu.5.date": "SET 2012 - JUL 2016",
    "edu.5.school": "Institut Duc de Montblanc, Barcelona",
    "edu.5.title": "Educació Secundària Obligatòria (ESO)",
    "skills.title": "Habilitats i Idiomes",
    "skills.skills_title": "Competències",
    "skills.lang_title": "Idiomes",
    "skills.s1": "Gestió operativa de restaurant",
    "skills.s2": "Lideratge i formació d'equips",
    "skills.s3": "Control de costos i pressupostos",
    "skills.s4": "Estàndards de marca i qualitat",
    "skills.s5": "Experiència de l'hoste",
    "skills.s6": "Gestió d'inventaris i proveïdors",
    "skills.s7": "Planificació d'esdeveniments i banquets",
    "skills.s8": "Coordinació sala-cuina",
    "skills.l1.name": "Català",
    "skills.l1.level": "Natiu",
    "skills.l2.name": "Espanyol",
    "skills.l2.level": "Natiu",
    "skills.l3.name": "Anglès",
    "skills.l3.level": "Bilingüe",
    "ref.title": "Referències",
    "ref.1.name": "Carmine Donadio",
    "ref.1.role": "F&B Director",
    "ref.1.company": "Gran Meliá Jakarta",
    "ref.2.name": "Airam Lorenzo",
    "ref.2.role": "F&B Director",
    "ref.2.company": "Gran Meliá Torre Melina",
    "ref.3.name": "Aitor Xavier Zurutuza",
    "ref.3.role": "F&B Manager",
    "ref.3.company": "Oteiza Akelarre",
    "ref.note": "Dades de contacte disponibles sota petició.",
    "contact.title": "Contacte",
    "contact.phone": "+34 615 410 012",
    "contact.email": "mireiapuchaes@gmail.com",
    "contact.loc": "Rubí, Barcelona, Espanya",
    "footer.rights": "© 2026 Mireia Puchaes Cremades. Tots els drets reservats.",
    "btn.expand": "Veure tot",
    "btn.collapse": "Tancar",
    "btn.download": "Descarregar CV"
  }
};

// DARK SECTIONS - Injected by generate.js
const darkSections = ["about","experience","skills"];

// NAV ACCENT RGB - Injected by generate.js (extracted from theme --accent-color)
const navAccentRgb = [184,149,106];

// EXPANDABLE TIMELINE LOGIC
window.toggleTimeline = function (id, btn) {
    const container = document.getElementById(id);
    const isCollapsed = container.classList.contains('collapsed');
    const currentLang = localStorage.getItem('preferredLang') || 'es';

    if (isCollapsed) {
        // EXPAND
        container.classList.remove('collapsed');
        container.classList.add('expanded');

        const span = btn.querySelector('span');
        const icon = btn.querySelector('ion-icon');
        if (span) span.textContent = translations[currentLang]["btn.collapse"] || "Cerrar";
        if (icon) icon.setAttribute('name', 'chevron-up-outline');

        container.scrollTop = 0;

        // Install BOTH scroll and wheel handlers unconditionally.
        // CSS transition on max-height (0.8s) makes a single early check unreliable
        // — each handler checks the real-time state when its event fires.

        // Scroll handler: auto-collapse when user scrolls to bottom (overflow case)
        let scrollTimeout = null;
        container._scrollEndHandler = function() {
            if (scrollTimeout) clearTimeout(scrollTimeout);
            scrollTimeout = setTimeout(() => {
                const scrollBottom = container.scrollTop + container.clientHeight;
                const scrollMax = container.scrollHeight;
                if (scrollBottom >= scrollMax - 5) {
                    collapseAndScrollNext(container, btn);
                }
            }, 800);
        };
        container.addEventListener('scroll', container._scrollEndHandler);

        // Wheel handler on the SECTION (not just the container) to also cover
        // the gap area below the timeline where overflow:hidden traps scroll.
        var section = container.closest('section');
        let wheelDebounce = null;
        container._wheelHandler = function(e) {
            if (wheelDebounce) return;
            // Check in real time whether content actually overflows
            var contentOverflows = container.scrollHeight > container.clientHeight + 10;
            if (!contentOverflows && e.deltaY > 0) {
                e.preventDefault();
                wheelDebounce = setTimeout(function() { wheelDebounce = null; }, 500);
                collapseAndScrollNext(container, btn);
            }
        };
        (section || container).addEventListener('wheel', container._wheelHandler, { passive: false });
    } else {
        // COLLAPSE
        collapseTimeline(container, btn);
    }
};

function collapseTimeline(container, btn) {
    const currentLang = localStorage.getItem('preferredLang') || 'es';

    container.classList.add('collapsed');
    container.classList.remove('expanded');

    // Remove scroll and wheel listeners, reset overscroll override
    if (container._scrollEndHandler) {
        container.removeEventListener('scroll', container._scrollEndHandler);
        container._scrollEndHandler = null;
    }
    if (container._wheelHandler) {
        // Wheel handler lives on the section (parent), not the container
        var section = container.closest('section');
        (section || container).removeEventListener('wheel', container._wheelHandler);
        container._wheelHandler = null;
    }
    container.style.overscrollBehaviorY = '';

    const span = btn.querySelector('span');
    const icon = btn.querySelector('ion-icon');
    if (span) span.textContent = translations[currentLang]["btn.expand"] || "Ver todo";
    if (icon) icon.setAttribute('name', 'chevron-down-outline');

    container.scrollTop = 0;
}

function collapseAndScrollNext(container, btn) {
    // First, collapse the timeline
    collapseTimeline(container, btn);

    // Find the parent section
    const section = container.closest('section');
    if (!section) return;

    // Find the next sibling section
    const nextSection = section.nextElementSibling;
    if (nextSection && (nextSection.tagName === 'SECTION' || nextSection.tagName === 'FOOTER')) {
        // Small delay to let collapse animation start
        setTimeout(() => {
            nextSection.scrollIntoView({ behavior: 'auto', block: 'start' });
        }, 100);
    }
}

document.addEventListener('DOMContentLoaded', () => {
    // Language Switcher
    let currentLang = localStorage.getItem('preferredLang') || 'es';
    updateLanguage(currentLang);

    // Lang Switcher Interaction
    const langSwitcher = document.querySelector('.lang-switcher-bottom');
    if (langSwitcher) {
        langSwitcher.addEventListener('click', function (e) {
            const targetBtn = e.target.closest('.lang-btn-bottom');
            if (!targetBtn) return;

            if (this.classList.contains('expanded')) {
                if (!targetBtn.classList.contains('active')) {
                    const selectedLang = targetBtn.getAttribute('data-lang');
                    if (selectedLang) {
                        currentLang = selectedLang;
                        updateLanguage(currentLang);
                    }
                }
                this.classList.remove('expanded');
            } else {
                this.classList.add('expanded');
            }
        });

        document.addEventListener('click', function (e) {
            if (!langSwitcher.contains(e.target)) {
                langSwitcher.classList.remove('expanded');
            }
        });
    }

    // BURGER MENU LOGIC
    window.toggleBurgerMenu = function () {
        const burgerBtn = document.getElementById('burger-btn');
        const menuOverlay = document.getElementById('menu-overlay');
        const cutleryBurger = burgerBtn ? burgerBtn.querySelector('.cutlery-burger') : null;
        const bottomNav = document.querySelector('.bottom-nav');
        if (!burgerBtn || !menuOverlay) return;

        menuOverlay.classList.toggle('open');
        const isOpen = menuOverlay.classList.contains('open');

        if (cutleryBurger) {
            // Hospitality theme: cutlery → X animation via CSS class
            cutleryBurger.classList.toggle('burger-open', isOpen);
        } else {
            // Generic theme (medical etc.): swap ion-icon between menu ↔ close
            const icon = burgerBtn.querySelector('ion-icon');
            if (icon) {
                icon.setAttribute('name', isOpen ? 'close-outline' : 'menu-outline');
            }
        }
        // Toggle accent colors when menu overlay is open (dark background)
        if (bottomNav) {
            bottomNav.classList.toggle('menu-open', isOpen);
        }
    };

    // Close menu on link click — scroll within #app-scroller
    document.querySelectorAll('.menu-link').forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const menuOverlay = document.getElementById('menu-overlay');
            const burgerBtn = document.getElementById('burger-btn');
            const bottomNav = document.querySelector('.bottom-nav');
            if (menuOverlay) menuOverlay.classList.remove('open');
            if (burgerBtn) {
                const cutleryBurger = burgerBtn.querySelector('.cutlery-burger');
                if (cutleryBurger) {
                    cutleryBurger.classList.remove('burger-open');
                } else {
                    const icon = burgerBtn.querySelector('ion-icon');
                    if (icon) icon.setAttribute('name', 'menu-outline');
                }
            }
            if (bottomNav) bottomNav.classList.remove('menu-open');

            // Scroll to section within #app-scroller
            const targetId = link.getAttribute('href').replace('#', '');
            const targetSection = document.getElementById(targetId);
            if (targetSection) {
                targetSection.scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        });
    });

    // Handle CTA button scroll within #app-scroller
    const ctaBtn = document.querySelector('.btn-primary[href="#contact"]');
    if (ctaBtn) {
        ctaBtn.addEventListener('click', (e) => {
            e.preventDefault();
            const contactSection = document.getElementById('contact');
            if (contactSection) {
                contactSection.scrollIntoView({ behavior: 'auto', block: 'start' });
            }
        });
    }

    // Set initial nav color
    if (document.querySelector('.bottom-nav')) {
        document.querySelector('.bottom-nav').style.setProperty('--nav-adaptive-color', 'rgb(28,28,28)');
    }

    // Scroll animations — IntersectionObserver
    var animElements = document.querySelectorAll('.animate-on-scroll');
    if (animElements.length > 0 && 'IntersectionObserver' in window) {
        var animObserver = new IntersectionObserver(function(entries) {
            entries.forEach(function(entry) {
                if (entry.isIntersecting) {
                    entry.target.classList.add('visible');
                    animObserver.unobserve(entry.target);
                }
            });
        }, {
            root: document.getElementById('app-scroller'),
            threshold: 0.15,
            rootMargin: '0px 0px -50px 0px'
        });
        animElements.forEach(function(el) {
            animObserver.observe(el);
        });
    } else {
        // Fallback: show all elements immediately
        animElements.forEach(function(el) {
            el.classList.add('visible');
        });
    }
});

// Adaptive nav colors — scroll-synced loop
function _navColorTick() {
    var nav = document.querySelector('.bottom-nav');
    var scroller = document.getElementById('app-scroller');
    if (!nav || !scroller) return;
    if (nav.classList.contains('menu-open')) return;

    var rect = scroller.getBoundingClientRect();
    var viewH = rect.height;
    if (viewH <= 0) return;

    var sections = document.querySelectorAll('header, section, footer');
    var dark = 0;

    for (var i = 0; i < sections.length; i++) {
        var s = sections[i];
        var sr = s.getBoundingClientRect();
        var vt = Math.max(sr.top, rect.top);
        var vb = Math.min(sr.bottom, rect.bottom);
        var vh = vb - vt;
        if (vh > 0 && darkSections.indexOf(s.id) !== -1) {
            dark += vh / viewH;
        }
    }

    dark = Math.min(1, Math.max(0, dark));
    var r = Math.round(28 + (navAccentRgb[0] - 28) * dark);
    var g = Math.round(28 + (navAccentRgb[1] - 28) * dark);
    var b = Math.round(28 + (navAccentRgb[2] - 28) * dark);
    nav.style.setProperty('--nav-adaptive-color', 'rgb(' + r + ',' + g + ',' + b + ')');
}
setInterval(_navColorTick, 16);

// Snap-visible detection
var _lastVisibleSection = null;
function _snapVisibleTick() {
    var scroller = document.getElementById('app-scroller');
    if (!scroller) return;

    var scrollerRect = scroller.getBoundingClientRect();
    var centerY = scrollerRect.top + scrollerRect.height / 2;

    var sections = document.querySelectorAll('header, section, footer');
    var bestSection = null;
    var bestOverlap = 0;

    for (var i = 0; i < sections.length; i++) {
        var s = sections[i];
        var sr = s.getBoundingClientRect();
        var vt = Math.max(sr.top, scrollerRect.top);
        var vb = Math.min(sr.bottom, scrollerRect.bottom);
        var vh = vb - vt;

        if (vh > bestOverlap) {
            bestOverlap = vh;
            bestSection = s;
        }
    }

    if (bestSection && bestSection !== _lastVisibleSection) {
        if (_lastVisibleSection) {
            _lastVisibleSection.classList.remove('snap-visible');
        }
        bestSection.classList.add('snap-visible');
        _lastVisibleSection = bestSection;

        // Auto-collapse timelines when leaving experience/education sections
        if (bestSection &&
            (bestSection.id === 'experience' || bestSection.id === 'education')) {
            // Do nothing, user is viewing this section
        } else {
            var expandedTimelines = document.querySelectorAll('.timeline-container.expanded');
            expandedTimelines.forEach(function(tl) {
                var btn = tl.parentElement.querySelector('.btn-expand');
                if (btn) {
                    collapseTimeline(tl, btn);
                }
            });
        }
    }
}
setInterval(_snapVisibleTick, 100);

function updateLanguage(lang) {
    if (!translations[lang]) return;

    // Update text content
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang][key]) {
            el.textContent = translations[lang][key];
        }
    });

    // Update active button
    document.querySelectorAll('.lang-btn-bottom').forEach(btn => {
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });

    // Save preference
    localStorage.setItem('preferredLang', lang);
}
